---
import BaseLayout from '../../layouts/BaseLayout.astro';
import siteData from '../../../siteData.mjs';
import { getCollection, getEntryBySlug } from 'astro:content';
import { Image } from 'astro:assets';

// 全 slug を静的生成
export async function getStaticPaths() {
    const allNews = await getCollection('news');
    return allNews.map((entry) => ({ params: { slug: entry.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug('news', slug);

if (!entry) {
    throw new Error(`記事が見つかりませんでした: ${slug}`);
}

const { Content } = await entry.render();
const { data } = entry;

const dateText = typeof data.date === 'string' ? data.date : data.date.toISOString().slice(0, 10);
---

<BaseLayout title={data.title}>
    <article class="news-article l-wrapper py-10 sm:pt-4" data-aos="fade-left" data-aos-delay="200">
        <div class="l-container">
            <div class="l-inner">
                <nav class="breadcrumb flex justify-end mt-3 sm:mt-6" aria-label="パンくずリスト">
                    <ol>
                        <li><a href={siteData.news.path}>お知らせ</a></li>
                        <li><span aria-current="page">{data.title}</span></li>
                    </ol>
                </nav>

                <h2 class="font-bold mb-2 u-heading-line">{data.title}</h2>
                <p class="font-bold mb-6">
                    {dateText} ／ {data.category}
                </p>

                {
                    data.image && (
                        <figure class="mb-6 img-wrapper w-harf rounded-lg sm:w-full">
                            <Image src={data.image} alt={data.title} loading="lazy" />
                        </figure>
                    )
                }

                <div class="news-body">
                    <Content />
                </div>
            </div>
        </div>
    </article>
</BaseLayout>
